chrome.runtime.onMessage.addListener((a,i,c)=>(a.type==="LSAT_DATA_COLLECTED"&&(chrome.storage.local.get(["lsatData"],r=>{const s=r.lsatData||[],n=a.data,o=new Map;s.forEach(e=>{o.set(e.questionId,e)});const t=[...s];let l=0;n.forEach(e=>{o.has(e.questionId)?console.log(`Skipping duplicate question: ${e.questionId}`):(t.push(e),l++)}),chrome.storage.local.set({lsatData:t},()=>{try{chrome.runtime.sendMessage({type:"LSAT_DATA_UPDATE",data:t,newQuestions:n.filter(e=>!o.has(e.questionId)),status:`Collected ${l} new questions. Total: ${t.length}`,complete:a.complete})}catch(e){console.log("Could not send message to popup:",e)}})}),c({success:!0})),!0));chrome.runtime.onInstalled.addListener(()=>{console.log("LSAT Demon Analyzer installed")});
